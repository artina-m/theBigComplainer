<html>
    <head>
        <title>The Big Complainer</title>
        <script src="https://d3js.org/d3.v4.min.js"></script>
        <script src="http://d3js.org/topojson.v2.min.js"></script>
        <link rel = "stylesheet" type="text/css" href = "index.css">
    </head>

<body>

<div class = "visualization">

        <div class = "firstSection">
            <h1> The Big Complainer</h1>
        </div>

        <div class = "secondSection">
        </div>

        <div class = "thirdSection">
        </div>

</div>

    
<script>

    // Load Data
    function parseLine(line) {
        return {
            uniqueKey: Number(line["Unique Key"]),
            date: line["Created Date"],
            complaintType: line["Complaint Type"],
            zipcode: line["Incident Zip"],
            latitude: Number(line["Latitude"]),
            longitude: Number(line["Longitude"]),
            nieghborhood: line["Neighborhood"]
        }
    }

    var complaintData;

    d3.tsv("ManhattanComplaints", parseLine, function(error,data){
        complaintData = data;
    })
    
    // MAP
    var svg1 = d3.select(".secondSection").append("svg")
    .attr("width", "100%")
    .attr("height", "100%");


    d3.json("nyc.geojson", function(error, nyb) {
        var projection = d3.geoMercator()
        .center([-74.04, 40.75])
        .scale(195000)
        .translate([(200/2 - 150), (400)/2+180]);

        var path = d3.geoPath().projection(projection);
        var g1 = svg1.append("g");

        g1.append("g")
            .attr("id", "postalCode")
            .selectAll(".state")
            .data(nyb.features)
            .enter().append("path")
            .attr("class", function(d){ return d.properties.name; })
            .attr("d", path)
            .attr("fill", function(d){
            if (d.properties.postalCode == "10003" ||  d.properties.postalCode ==  "10009" ||  d.properties.postalCode ==  "10002") {return "orange"}
            else {
                return"lightgrey"}
        })
            .attr("stroke", "white")


    })
</script>
    
    
    
<!--- Helper Functions -->

<script>
    // Call to change into date
    function change2Date(data){
        var i=0;
        while(i<data.length){
            if(data[i].date.substring(20,22) == "PM"){
                data[i].date = new Date(2017,
                    //month 00 is January
                    Number(data[i].date.substring(0,2))-1,
                    Number(data[i].date.substring(3,5)),
                    //adding 12 hours if it is PM
                    Number(data[i].date.substring(11,13)+12),
                    Number(data[i].date.substring(14,16)),
                    Number(data[i].date.substring(17,19)));
                    i++;
            }    
            else{
                data[i].date = new Date(2017, Number(data[i].date.substring(0,2))-1, Number(data[i].date.substring(3,5)), Number(data[i].date.substring(11,13)), Number(data[i].date.substring(14,16)),
                Number(data[i].date.substring(17,19)));
                i++;
            } 
        }
        return complaintData;
    }
</script>
    
    
</body>

<!-- Refrences -->
    
</html>